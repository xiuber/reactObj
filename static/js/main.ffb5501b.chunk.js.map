{"version":3,"sources":["index.js"],"names":["clock","scene","stats","camera","sceneAttributes","speed","runningSpeed","jump","gravity","maxSpeed","background","cameraDistance","debug","damping","playerSpeed","running","playerOnFloor","mixers","STEPS_PER_FRAME","style","height","window","innerHeight","width","innerWidth","App","_Component","_getPrototypeOf2","_this2","_classCallCheck","this","_len","arguments","length","args","Array","_key","_possibleConstructorReturn","_getPrototypeOf","call","apply","concat","controls","deltaTime","_this","_assertThisInitialized","speedDelta","keyStates","joyStates","playerVelocity","add","getForwardVector","multiplyScalar","getSideVector","y","animate","Math","min","getDelta","i","updatePlayer","updateSpheres","teleportPlayerIfOob","_step","_iterator","_createForOfIteratorHelper","s","n","done","value","update","err","e","f","renderer","render","requestAnimationFrame","_inherits","_createClass","key","init","_this3","THREE","fog","antialias","setPixelRatio","devicePixelRatio","setSize","shadowMap","enabled","type","outputEncoding","toneMapping","mount","appendChild","domElement","rotation","order","fillLight1","position","set","directionalLight","castShadow","shadow","near","far","right","left","top","bottom","mapSize","radius","bias","Stats","Soldiers","spheres","SPHERE_RADIUS","sphereGeometry","sphereMaterial","color","sphere","receiveShadow","push","mesh","collider","velocity","worldOctree","Octree","playerCollider","Capsule","playerDirection","stateList","currentAction","previousAction","vector1","vector2","vector3","document","addEventListener","event","code","fadeToAction","x","z","body","requestPointerLock","performance","now","pointerLockElement","movementX","movementY","onWindowResize","isMobile","windowHalfX","windowHalfY","istouch","toucheNow","preventDefault","touches","index","pageX","pageY","passive","mousex","mousey","JcoystickL","nipplejs","create","zone","getElementById","mode","size","multitouch","restJoystick","on","evt","data","console","log","setjoyStates","MTLLoader","setPath","load","materials","preload","OBJLoader","setMaterials","object","fromGraphNode","helper","OctreeHelper","visible","gui","GUI","onChange","GLTFLoader","gltf","traverse","isMesh","model1","mixer1","Standing","clipAction","animations","Walking","Running","play","state","aspect","updateProjectionMatrix","result","capsuleIntersect","normal","addScaledVector","dot","translate","depth","exp","deltaPosition","clone","playerCollisions","copy","end","getWorldDirection","normalize","_step2","_iterator2","Soldier","start","center","addVectors","sphere_center","r","r2","_i","_arr","point","d2","distanceToSquared","subVectors","v1","v2","sub","d","sqrt","s1","j","s2","forEach","sphereIntersect","playerSphereCollision","spheresCollisions","_step3","_iterator3","cross","up","name","duration","fadeOut","reset","setEffectiveTimeScale","setEffectiveWeight","fadeIn","navigator","userAgent","match","_this4","React","createElement","Fragment","ref","id","className","Component","Container","_React$Component","_getPrototypeOf3","_this5","_len2","_key2","percentComplete","rootElement","ReactDOM","createRoot"],"mappings":"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","file":"static/js/main.ffb5501b.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport ReactDOM from \"react-dom/client\";\r\nimport * as THREE from \"three\";\r\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\nimport { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\";\r\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\";\r\nimport { Octree } from \"three/examples/jsm/math/Octree\";\r\nimport { OctreeHelper } from \"three/examples/jsm/helpers/OctreeHelper\";\r\nimport { Capsule } from \"three/examples/jsm/math/Capsule\";\r\nimport { GUI } from \"three/examples/jsm/libs/lil-gui.module.min.js\";\r\nimport Stats from \"three/examples/jsm/libs/stats.module\";\r\nimport nipplejs from 'nipplejs'\r\nimport './index.css';\r\n/**\r\n *\r\n * 定义全局属性\r\n * @type {flaot} speed\r\n * @type {flaot} jump\r\n * @type {flaot} gravity\r\n * @type {flaot} maxSpeed\r\n * @type {string} background\r\n * @type {flaot} cameraDistance\r\n * @type {boolean} debug\r\n * @type {flaot} damping\r\n */\r\nlet sceneAttributes = {\r\n    \"speed\": 10,                //移动速度\r\n    \"runningSpeed\": 30,         //跑步速度\r\n    \"jump\": 15,                 //跳跃高度\r\n    \"gravity\": 30,              //重力加速度\r\n    \"maxSpeed\": 0.5,            //最大速度\r\n    \"background\": 0x88ccee,     //背景颜色\r\n    \"cameraDistance\": 3,      //镜头距离\r\n    \"debug\": false,             //是否显示debug信息\r\n    \"damping\": 4,               //阻尼系数\r\n};\r\nlet playerSpeed = sceneAttributes[\"speed\"]; //玩家移动速度\r\nlet running = false;            //是否跑步\r\nlet playerOnFloor = false;      //是否在地面上\r\n// GUI 参数\r\nvar guiParams = {\r\n    debug: false,\r\n    zoom: 1.0,\r\n    jumpHight: 8,\r\n    speed: 1,\r\n    exposure: 1,\r\n};\r\nlet clock;                  //计时器\r\nlet scene;                  // 创建场景\r\nlet stats;                  //性能监视器\r\nlet camera;                 // 创建摄像机\r\nlet mouseTime = 0;\r\nconst mixers = [];\r\nconst STEPS_PER_FRAME=5;\r\nconst style = { height: window.innerHeight - 50, width: window.innerWidth };\r\nclass App extends Component {\r\n  componentDidMount() {\r\n    this.init(); //init\r\n    this.animate();\r\n  }\r\n  componentWillUnmount() {\r\n   \r\n  }\r\n  init(){//初始化\r\n    let _this=this;\r\n    clock = new THREE.Clock(); // 计时器\r\n    scene = new THREE.Scene(); // 场景设置\r\n    // 设置背景颜色和雾化效果\r\n    scene.background = new THREE.Color(0x88ccee);\r\n    scene.fog = new THREE.Fog(0x88ccee, 0, 300);\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: true\r\n    });\r\n    this.renderer.setPixelRatio(window.devicePixelRatio);\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.shadowMap.enabled = true;\r\n    this.renderer.shadowMap.type = THREE.VSMShadowMap;\r\n    this.renderer.outputEncoding = THREE.sRGBEncoding;\r\n    this.renderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n    this.mount.appendChild(this.renderer.domElement);\r\n    // 摄像机设置\r\n    camera = new THREE.PerspectiveCamera(100, window.innerWidth / window.innerHeight, 0.1, 1000);\r\n    camera.rotation.order = 'YXZ'; // 坐标系\r\n    // 加入灯光\r\n    const fillLight1 = new THREE.HemisphereLight(0x4488bb, 0x002244, 0.5);\r\n    fillLight1.position.set(2, 1, 1);\r\n    scene.add(fillLight1);\r\n    // 加入光源\r\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\r\n    directionalLight.position.set(-5, 25, -1);\r\n    directionalLight.castShadow = true;\r\n    directionalLight.shadow.camera.near = 0.01;\r\n    directionalLight.shadow.camera.far = 500;\r\n    directionalLight.shadow.camera.right = 30;\r\n    directionalLight.shadow.camera.left = -30;\r\n    directionalLight.shadow.camera.top = 30;\r\n    directionalLight.shadow.camera.bottom = -30;\r\n    directionalLight.shadow.mapSize.width = 1024;\r\n    directionalLight.shadow.mapSize.height = 1024;\r\n    directionalLight.shadow.radius = 4;\r\n    directionalLight.shadow.bias = -0.00006;\r\n    scene.add(directionalLight);\r\n\r\n    // 性能监视器\r\n    stats = new Stats();\r\n    stats.domElement.style.position = 'absolute';\r\n    stats.domElement.style.top = '0px';\r\n    this.mount.appendChild(stats.domElement);\r\n\r\n    this.Soldiers = []; // 人体模型\r\n    // 球的参数\r\n    this.spheres = [];\r\n    let sphereIdx = 0;\r\n\r\n    const NUM_SPHERES = 100; // 数量\r\n    this.SPHERE_RADIUS = 0.1; // 大小\r\n\r\n    // 外观和贴图\r\n    const sphereGeometry = new THREE.IcosahedronGeometry(_this.SPHERE_RADIUS, 5);\r\n    const sphereMaterial = new THREE.MeshLambertMaterial({\r\n        color: 0xbbbb44\r\n    });\r\n\r\n    for (let i = 0; i < NUM_SPHERES; i++) {\r\n        const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);\r\n        sphere.castShadow = true;\r\n        sphere.receiveShadow = true;\r\n        scene.add(sphere);\r\n        _this.spheres.push({\r\n            mesh: sphere,\r\n            collider: new THREE.Sphere(new THREE.Vector3(0, -100, 0), _this.SPHERE_RADIUS),\r\n            velocity: new THREE.Vector3()\r\n        });\r\n    }\r\n\r\n    this.worldOctree = new Octree();\r\n    this.playerCollider = new Capsule(new THREE.Vector3(0, 0.35, 0), new THREE.Vector3(0, 2, 0), 0.35);\r\n\r\n    this.playerVelocity = new THREE.Vector3(); // 人物速度\r\n    this.playerDirection = new THREE.Vector3(); // 人物位置\r\n\r\n    this.keyStates = {};\r\n    this.joyStates = {};\r\n    this.stateList = {}; //人物姿态\r\n\r\n    this.currentAction='';\r\n    this.previousAction='';\r\n    this.vector1 = new THREE.Vector3();\r\n    this.vector2 = new THREE.Vector3();\r\n    this.vector3 = new THREE.Vector3();\r\n\r\n    document.addEventListener('keydown', (event) => {\r\n        _this.keyStates[event.code] = true;\r\n        \r\n        if ( _this.keyStates['KeyW'] ||  _this.keyStates['KeyS'] ||  _this.keyStates['KeyA'] ||  _this.keyStates['KeyD']) {\r\n            if (_this.stateList['Standing'] == _this.currentAction) {\r\n                if(running) {\r\n                      this.fadeToAction('Running', 0.4);\r\n                    // currentAction = stateList['Running'];\r\n                } else {\r\n                    this.fadeToAction('Walking', 0.2);\r\n                    // currentAction = stateList['Walking'];\r\n                }\r\n            }\r\n        }else if( _this.keyStates['KeyR'])\r\n        {\r\n            running = !running;\r\n            if(running) {\r\n                playerSpeed = sceneAttributes[\"runningSpeed\"];\r\n            }else {\r\n                playerSpeed = sceneAttributes[\"speed\"];\r\n            }\r\n        }\r\n    });\r\n\r\n    document.addEventListener('keyup', (event) => {\r\n      _this.keyStates[event.code] = false;\r\n        if (!( _this.keyStates['KeyW'] ||  _this.keyStates['KeyS'] ||  _this.keyStates['KeyA'] ||  _this.keyStates['KeyD'])) {\r\n            if (_this.stateList['Standing'] !== _this.currentAction) {\r\n                this.fadeToAction('Standing', 0.2);\r\n                _this.playerVelocity.x = 0;;\r\n                _this.playerVelocity.z = 0;;\r\n            }\r\n        }\r\n    });\r\n\r\n    document.addEventListener('mousedown', () => {\r\n        document.body.requestPointerLock();\r\n        mouseTime = performance.now();\r\n    });\r\n\r\n    // 鼠标转动\r\n    document.addEventListener('mousemove', (event) => {\r\n      if (document.pointerLockElement === document.body) {\r\n          camera.rotation.y -= event.movementX / 500;\r\n          camera.rotation.x -= event.movementY / 500;\r\n      }\r\n    });\r\n    window.addEventListener('resize', this.onWindowResize());\r\n\r\n    if (this.isMobile()) {\r\n      // 触控\r\n      let windowHalfX, windowHalfY;\r\n      let istouch = false;\r\n      let toucheNow = 0;\r\n      document.addEventListener('touchstart', (event) => {\r\n          // 阻止窗口滚动行为\r\n          event.preventDefault();\r\n\r\n          // 两个手指触摸，主要是左右同时操作的时候\r\n          const n = event.touches.length;\r\n\r\n          for (let index = 0; index < n; index++) {\r\n              const elem = event.touches[index];\r\n              if (elem.pageX > window.innerWidth / 2) {\r\n                  istouch = true;\r\n                  windowHalfX = event.touches[index].pageX;\r\n                  windowHalfY = event.touches[index].pageY;\r\n                  toucheNow = index;\r\n                  break;\r\n              }\r\n          }\r\n      }, {\r\n          passive: false\r\n      });\r\n      document.addEventListener('touchmove', (event) => {\r\n          if (istouch) {\r\n              const mousex = event.touches[toucheNow].pageX - windowHalfX;\r\n              const mousey = event.touches[toucheNow].pageY - windowHalfY;\r\n              camera.rotation.y -= mousex / 500;\r\n              camera.rotation.x -= mousey / 500;\r\n              windowHalfX = event.touches[toucheNow].pageX;\r\n              windowHalfY = event.touches[toucheNow].pageY;\r\n          }\r\n      });\r\n      document.addEventListener('touchend', (event) => {\r\n          if (typeof (event.touches[toucheNow]) == \"undefined\") {\r\n              istouch = false;\r\n              toucheNow = 0;\r\n          }\r\n      });\r\n      const JcoystickL = nipplejs.create({\r\n          zone: document.getElementById(\"left\"),\r\n          mode: \"semi\",\r\n          position: {\r\n              left: \"50%\",\r\n              top: \"50%\"\r\n          },\r\n          color: \"white\",\r\n          size: 150,\r\n          multitouch: true,\r\n          restJoystick: {\r\n              y: true\r\n          }\r\n      });\r\n\r\n      JcoystickL.on('start', function (evt, data) {\r\n        console.log(data);\r\n          if (_this.stateList['Walking'] !== _this.currentAction) {\r\n            _this.fadeToAction('Walking', 0.2);\r\n          }\r\n      });\r\n      JcoystickL.on('end', function (evt, data) {\r\n          if (_this.stateList['Standing'] !== _this.currentAction) {\r\n            _this.fadeToAction('Standing', 0.2);\r\n          }\r\n          _this.setjoyStates(\"\");\r\n      });\r\n      JcoystickL.on('dir:up',\r\n          function (evt, data) {\r\n            _this.joyStates[\"up\"] = true;\r\n              _this.setjoyStates(\"up\");\r\n          }\r\n      );\r\n      JcoystickL.on('dir:down',\r\n          function (evt, data) {\r\n            _this.joyStates[\"down\"] = true;\r\n              _this.setjoyStates(\"down\");\r\n          }\r\n      );\r\n      JcoystickL.on('dir:left',\r\n          function (evt, data) {\r\n            _this.joyStates[\"left\"] = true;\r\n              _this.setjoyStates(\"left\");\r\n          }\r\n      );\r\n      JcoystickL.on('dir:right',\r\n          function (evt, data) {\r\n            _this.joyStates[\"right\"] = true;\r\n              _this.setjoyStates(\"right\");\r\n          }\r\n      );\r\n    }\r\n\r\n    // 场景导入\r\n    const loader = new MTLLoader();\r\n\r\n    loader.setPath(\"/\").load(\"city.mtl\", (materials) => {\r\n        materials.preload()\r\n        new OBJLoader().setMaterials(materials)\r\n        .setPath(\"/\")\r\n        .load(\"city.obj\",function(object){\r\n            object.position.set(50, 0, 3);\r\n            scene.add(object);\r\n            _this.worldOctree.fromGraphNode(object);\r\n        });\r\n        const helper = new OctreeHelper(_this.worldOctree);\r\n        helper.visible = false;\r\n        scene.add(helper);\r\n        const gui = new GUI({\r\n            width: 200\r\n        });\r\n\r\n        gui.add(sceneAttributes, 'debug').onChange(function (value) {\r\n            helper.visible = value;\r\n        });\r\n        gui.add(sceneAttributes,'cameraDistance', 0.5, 10);\r\n        gui.add(sceneAttributes, 'jump', 1, 50);\r\n    });\r\n\r\n    // 人物模型导入\r\n    const loader1 = new GLTFLoader();\r\n    loader1.load(\"/Soldier.glb\", function (gltf) {\r\n        gltf.scene.traverse(function (object) {\r\n            if (object.isMesh) object.castShadow = true;\r\n        });\r\n\r\n        const model1 = gltf.scene;\r\n        // 设定姿态\r\n        const mixer1 = new THREE.AnimationMixer(model1);\r\n        _this.stateList.Standing = mixer1.clipAction(gltf.animations[0]); // idle\r\n        _this.stateList.Walking = mixer1.clipAction(gltf.animations[3]); // walk\r\n        _this.stateList.Running = mixer1.clipAction(gltf.animations[1]); // run\r\n\r\n        // stateList.Standing.loop = THREE.LoopOnce;    //只运动一次 跳跃动作可以用\r\n        // 初始为站立姿态\r\n        _this.currentAction = _this.stateList.Standing;\r\n        _this.currentAction.play();\r\n        mixers.push(mixer1);\r\n        _this.Soldiers.push(model1);\r\n        scene.add(model1);\r\n    });\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n  setjoyStates(state) {\r\n    let _this=this;\r\n    for (const key in _this.joyStates) {\r\n        if (key === state) {\r\n          _this.joyStates[key] = true;\r\n        } else {\r\n          _this.joyStates[key] = false;\r\n        }\r\n    }\r\n  }\r\n  onWindowResize() {\r\n    camera.aspect = window.innerWidth / window.innerHeight;\r\n    camera.updateProjectionMatrix();\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n\r\n  playerCollisions() {\r\n    let _this=this;\r\n    const result = _this.worldOctree.capsuleIntersect(_this.playerCollider);\r\n    playerOnFloor = false;\r\n    if (result) {\r\n        playerOnFloor = result.normal.y > 0;\r\n        if (!playerOnFloor) {\r\n          _this.playerVelocity.addScaledVector(result.normal, -result.normal.dot(_this.playerVelocity));\r\n        }\r\n\r\n        _this.playerCollider.translate(result.normal.multiplyScalar(result.depth));\r\n    }\r\n  }\r\n\r\n  updatePlayer(deltaTime) {\r\n    let _this=this;\r\n    let damping = Math.exp(-sceneAttributes[\"damping\"] * deltaTime) - 1;\r\n    if (!playerOnFloor) {\r\n      _this.playerVelocity.y -= sceneAttributes[\"gravity\"] * deltaTime;\r\n\r\n        // small air resistance\r\n        damping *= 0.1;\r\n    }\r\n\r\n    _this.playerVelocity.addScaledVector(_this.playerVelocity, damping);\r\n\r\n    const deltaPosition = _this.playerVelocity.clone().multiplyScalar(deltaTime);\r\n    _this.playerCollider.translate(deltaPosition);\r\n\r\n    _this.playerCollisions();\r\n    camera.position.copy(_this.playerCollider.end);\r\n    camera.getWorldDirection(_this.playerDirection);\r\n    _this.playerDirection.normalize();\r\n\r\n    //镜头拉远的距离\r\n    camera.position.add(_this.playerDirection.multiplyScalar(-sceneAttributes[\"cameraDistance\"]));\r\n\r\n    for (const Soldier of _this.Soldiers) {\r\n        Soldier.position.copy(_this.playerCollider.start);\r\n        Soldier.rotation.z = camera.rotation.z;\r\n        Soldier.rotation.y = camera.rotation.y;\r\n    }\r\n  }\r\n\r\n  playerSphereCollision(sphere) {\r\n    let _this=this;\r\n    const center = _this.vector1.addVectors(_this.playerCollider.start, _this.playerCollider.end).multiplyScalar(0.5);\r\n    const sphere_center = sphere.collider.center;\r\n    const r = _this.playerCollider.radius + sphere.collider.radius;\r\n    const r2 = r * r;\r\n    for (const point of [_this.playerCollider.start, _this.playerCollider.end, center]) {\r\n        const d2 = point.distanceToSquared(sphere_center);\r\n\r\n        if (d2 < r2) {\r\n            const normal = _this.vector1.subVectors(point, sphere_center).normalize();\r\n            const v1 = _this.vector2.copy(normal).multiplyScalar(normal.dot(_this.playerVelocity));\r\n            const v2 = _this.vector3.copy(normal).multiplyScalar(normal.dot(sphere.velocity));\r\n\r\n            _this.playerVelocity.add(v2).sub(v1);\r\n            sphere.velocity.add(v1).sub(v2);\r\n\r\n            const d = (r - Math.sqrt(d2)) / 2;\r\n            sphere_center.addScaledVector(normal, -d);\r\n        }\r\n    }\r\n  }\r\n  spheresCollisions() {\r\n    let _this=this;\r\n    for (let i = 0, length = _this.spheres.length; i < length; i++) {\r\n\r\n        const s1 = _this.spheres[i];\r\n        for (let j = i + 1; j < length; j++) {\r\n            const s2 = _this.spheres[j];\r\n            const d2 = s1.collider.center.distanceToSquared(s2.collider.center);\r\n            const r = s1.collider.radius + s2.collider.radius;\r\n            const r2 = r * r;\r\n\r\n            if (d2 < r2) {\r\n                const normal = _this.vector1.subVectors(s1.collider.center, s2.collider.center).normalize();\r\n                const v1 = _this.vector2.copy(normal).multiplyScalar(normal.dot(s1.velocity));\r\n                const v2 = _this.vector3.copy(normal).multiplyScalar(normal.dot(s2.velocity));\r\n\r\n                s1.velocity.add(v2).sub(v1);\r\n                s2.velocity.add(v1).sub(v2);\r\n\r\n                const d = (r - Math.sqrt(d2)) / 2;\r\n\r\n                s1.collider.center.addScaledVector(normal, d);\r\n                s2.collider.center.addScaledVector(normal, -d);\r\n            }\r\n        }\r\n    }\r\n  }\r\n  updateSpheres(deltaTime) {\r\n    let _this=this;\r\n    _this.spheres.forEach(sphere => {\r\n        sphere.collider.center.addScaledVector(sphere.velocity, deltaTime);\r\n        const result = _this.worldOctree.sphereIntersect(sphere.collider);\r\n\r\n        if (result) {\r\n            sphere.velocity.addScaledVector(result.normal, -result.normal.dot(sphere.velocity) * 1.5);\r\n            sphere.collider.center.add(result.normal.multiplyScalar(result.depth));\r\n        } else {\r\n            sphere.velocity.y -= sceneAttributes[\"gravity\"] * deltaTime;\r\n        }\r\n\r\n        const damping = Math.exp(-sceneAttributes[\"damping\"] * deltaTime) - 1;\r\n        sphere.velocity.addScaledVector(sphere.velocity, damping);\r\n        _this.playerSphereCollision(sphere);\r\n    });\r\n\r\n    _this.spheresCollisions();\r\n\r\n    for (const sphere of _this.spheres) {\r\n        sphere.mesh.position.copy(sphere.collider.center);\r\n    }\r\n  }\r\n  getForwardVector() {\r\n    let _this=this;\r\n    camera.getWorldDirection(_this.playerDirection);\r\n    _this.playerDirection.y = 0;\r\n    _this.playerDirection.normalize();\r\n    return _this.playerDirection;\r\n  }\r\n  getSideVector() {\r\n    let _this=this;\r\n    camera.getWorldDirection(_this.playerDirection);\r\n    _this.playerDirection.y = 0;\r\n    _this.playerDirection.normalize();\r\n    _this.playerDirection.cross(camera.up);\r\n    return _this.playerDirection;\r\n  }\r\n  // 键盘操作\r\n  controls=(deltaTime)=> {\r\n    let _this=this;\r\n    // gives a bit of air control\r\n    const speedDelta = deltaTime * (playerOnFloor ? playerSpeed : playerSpeed/4);\r\n\r\n    if ( _this.keyStates['KeyW'] || _this.joyStates[\"up\"]) {\r\n      _this.playerVelocity.add(_this.getForwardVector().multiplyScalar(speedDelta));\r\n    }\r\n\r\n    if ( _this.keyStates['KeyS'] || _this.joyStates[\"down\"]) {\r\n      _this.playerVelocity.add(_this.getForwardVector().multiplyScalar(-speedDelta));\r\n    }\r\n\r\n    if ( _this.keyStates['KeyA'] || _this.joyStates[\"left\"]) {\r\n      _this.playerVelocity.add(_this.getSideVector().multiplyScalar(-speedDelta));\r\n    }\r\n\r\n    if ( _this.keyStates['KeyD'] || _this.joyStates[\"right\"]) {\r\n      _this.playerVelocity.add(_this.getSideVector().multiplyScalar(speedDelta));\r\n    }\r\n\r\n    if (playerOnFloor) {\r\n        if ( _this.keyStates['Space']) {\r\n          _this.playerVelocity.y = sceneAttributes[\"jump\"];\r\n        }\r\n    }\r\n  }\r\n  // 动画播放 ，不同的动作，播放不同的视频\r\n  fadeToAction(name, duration) {\r\n    let _this=this;\r\n    _this.previousAction = _this.currentAction;\r\n    _this.currentAction = _this.stateList[name];\r\n    if (_this.previousAction !== _this.currentAction) {\r\n      _this.previousAction.fadeOut(duration);\r\n    }\r\n    if (_this.currentAction) {\r\n      _this.currentAction\r\n            .reset()\r\n            .setEffectiveTimeScale(1)\r\n            .setEffectiveWeight(1)\r\n            .fadeIn(duration)\r\n            .play();\r\n    }\r\n  }\r\n  //掉落有传送到初始地\r\n  teleportPlayerIfOob() {\r\n    let _this=this;\r\n    if (camera.position.y <= -25) {\r\n      _this.playerCollider.start.set(0, 0.35, 0);\r\n      _this.playerCollider.end.set(0, 3, 0);\r\n      _this.playerCollider.radius = 0.35;\r\n        camera.position.copy(_this.playerCollider.end);\r\n        camera.rotation.set(0, -10, 0);\r\n    }\r\n  }\r\n  animate=()=>{\r\n    let _this=this;\r\n    const deltaTime = Math.min(0.05, clock.getDelta()) / (STEPS_PER_FRAME);\r\n    for (let i = 0; i < STEPS_PER_FRAME; i++) {\r\n      _this.controls(deltaTime);\r\n      _this.updatePlayer(deltaTime);\r\n      _this.updateSpheres(deltaTime);\r\n      _this.teleportPlayerIfOob();\r\n        for (const mixer of mixers) mixer.update(deltaTime);\r\n    }\r\n    _this.renderer.render(scene, camera);\r\n    stats.update();\r\n    requestAnimationFrame(_this.animate);\r\n  }\r\n\r\n  isMobile() {\r\n    if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <>\r\n       <div style={style} ref={(ref) => (this.mount = ref)} ></div>\r\n       <div id=\"left\" className=\"zone\"></div>\r\n      </>\r\n     \r\n    );\r\n  }\r\n} \r\n\r\nclass Container extends React.Component {\r\n  state = {};\r\n  render() {\r\n    const { percentComplete = 0 } = this.state;\r\n    return (\r\n      <>\r\n        {\r\n          <App/>\r\n        }\r\n        \r\n      </>\r\n    );\r\n  }\r\n}\r\nconst rootElement = document.getElementById(\"root\");\r\nconst root = ReactDOM.createRoot(rootElement);\r\nroot.render(<Container />);\r\n"],"sourceRoot":""}